<!DOCTYPE html>
<html lang="en">

<head>

    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <meta name="viewport" content="width=device-width">

        <title>JobRole</title>

        <link rel="stylesheet" href="">

        <!-- Bootstrap libraries -->
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
        <!-- Bootstrap 5 CDN -->
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/css/bootstrap.min.css" rel="stylesheet"
            integrity="sha384-Zenh87qX5JnK2Jl0vWa8Ck2rdkQ2Bzep5IDxbcnCeuOxjzrPF/et3URy9Bv1WTRi" crossorigin="anonymous">
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/js/bootstrap.bundle.min.js"
            integrity="sha384-OERcA2EqjJCMA+/3y+gxIOqMEjwtxJY7qPCqsdltbNJuaOe923+mo//f6V8Qbsw3" crossorigin="anonymous">
        </script>

        <!-- Latest compiled and minified CSS -->
        <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.2.1/css/bootstrap.min.css"
            integrity="sha384-GJzZqFGwb1QTTN6wy59ffF1BuGJpLSa9DkKMp0DgiMDm4iYMj70gZWKYbI706tWS" crossorigin="anonymous">

        <!-- Latest compiled and minified JavaScript -->
        <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>

        <link rel="stylesheet" href="https://unpkg.com/tailwindcss@2.2.19/dist/tailwind.min.css" />

        <!--Replace with your tailwind.css once created-->
        <link href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:400,700" rel="stylesheet" />
        <!-- VUE 3 -->
        <script src="https://cdn.jsdelivr.net/npm/vue@2.6.12/dist/vue.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
        <!--Vue ScrollTo-->
        <script src="https://unpkg.com/vue-scrollto@2.7.9/vue-scrollto.js"></script>
        <!-- Flowbite -->
        <link rel="stylesheet" href="https://unpkg.com/flowbite@1.5.3/dist/flowbite.min.css" />
        <!--ICON-->
        <script src="https://code.iconify.design/iconify-icon/1.0.1/iconify-icon.min.js"></script>

        <style>
            .gradient {
                background: linear-gradient(90deg, #82cde8 0%, #78cea9 100%);
            }

            .backdrop {
                background-color: rgba(0, 0, 0, 0.4);
            }

            html {
                scroll-behavior: smooth;
            }
        </style>
    </head>

</head>

<body>

    <body class="leading-normal tracking-normal text-white" style="font-family: 'Source Sans Pro', sans-serif;">
        <div id="main-container">
            <!-- NAV BAR -->
            <nav id="header" class="fixed w-full z-30 top-0 text-white gradient py-2">
                <div class="container flex flex-wrap justify-between items-center mx-auto">
                    <!-- LOGO -->
                    <img src='../logo.png' width="109" height="109" class='mb-2'>

                    <div class="flex items-center md:order-2">
                        <button type="button"
                            class="flex mr-3 text-sm  rounded-full md:mr-0 focus:ring-4 focus:ring-gray-300 dark:focus:ring-gray-600"
                            id="user-menu-button" aria-expanded="false" data-dropdown-toggle="user-dropdown"
                            data-dropdown-placement="bottom">

                            <iconify-icon icon="carbon:user-avatar-filled-alt" style="color: white;" height='40'
                                width='40'>
                            </iconify-icon>
                        </button>

                        <!-- PROFILE Dropdown menu -->
                        <div class="hidden z-50 my-4 text-base list-none bg-white rounded divide-y divide-gray-100 shadow dark:bg-gray-700 dark:divide-gray-600"
                            id="user-dropdown">
                            <div class="py-3 px-4">
                                <span class="block text-sm text-gray-900 dark:text-white">Eric Loh</span>
                                <span class="block text-sm font-medium text-gray-500 truncate dark:text-gray-400">Staff
                                    ID:
                                    150008</span>
                                <span
                                    class="block text-sm font-medium text-gray-500 truncate dark:text-gray-400">Eric.Loh@allinone.com.sg</span>
                            </div>
                            <ul class="py-1" aria-labelledby="user-menu-button">
                                <li>
                                    <a href="../htdocs/main_home.html"
                                        class="block py-2 px-4 text-sm text-gray-700 hover:bg-gray-100 dark:hover:bg-gray-600 dark:text-gray-200 dark:hover:text-white">Sign
                                        out</a>
                                </li>
                            </ul>
                        </div>

                        <button data-collapse-toggle="mobile-menu-2" type="button"
                            class="inline-flex items-center p-2 ml-1 text-sm text-gray-500 rounded-lg md:hidden hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-gray-200 dark:text-gray-400 dark:hover:bg-gray-700 dark:focus:ring-gray-600"
                            aria-controls="mobile-menu-2" aria-expanded="false">
                            <span class="sr-only">Open main menu</span>
                            <svg class="w-6 h-6" aria-hidden="true" fill="currentColor" viewBox="0 0 20 20"
                                xmlns="http://www.w3.org/2000/svg">
                                <path fill-rule="evenodd"
                                    d="M3 5a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 10a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 15a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z"
                                    clip-rule="evenodd"></path>
                            </svg>
                        </button>

                    </div>

                    <div class="hidden justify-between items-center w-full md:flex md:w-auto md:order-1"
                        id="mobile-menu-2">
                        <ul
                            class="flex flex-col p-2 mt-1 md:flex-row md:space-x-8 md:mt-0 md:text-sm md:font-medium md:border-0 dark:bg-gray-800 ">
                            <li>
                                <a href="../htdocs/hr_ljmsHome.html"
                                    class="text-lg block py-2 pr-4 pl-3 text-white rounded hover:bg-gray-400  md:hover:bg-transparent md:hover:text-blue-700 md:p-0 dark:text-gray-400 md:dark:hover:text-white dark:hover:bg-gray-700 dark:hover:text-white md:dark:hover:bg-transparent dark:border-gray-700">Home</a>
                            </li>
                            <li>
                                <a href="../htdocs/hr_skills.html"
                                    class="text-lg block py-2 pr-4 pl-3 text-white rounded hover:bg-gray-400 md:hover:bg-transparent md:hover:text-blue-700 md:p-0 dark:text-gray-400 md:dark:hover:text-white dark:hover:bg-gray-700 dark:hover:text-white md:dark:hover:bg-transparent dark:border-gray-700">Skills</a>
                            </li>
                            <li>
                                <a href="../htdocs/hr_roles.html"
                                    class="text-lg block py-2 pr-4 pl-3 text-blue-700 rounded hover:bg-gray-400 md:hover:bg-transparent md:hover:text-blue-700 md:p-0 dark:text-gray-400 md:dark:hover:text-white dark:hover:bg-gray-700 dark:hover:text-white md:dark:hover:bg-transparent dark:border-gray-700">Roles</a>
                            </li>
                            <li>
                                <a href="../htdocs/hr_courses.html"
                                    class="text-lg block py-2 pr-4 pl-3 text-white rounded hover:bg-gray-400 md:hover:bg-transparent md:hover:text-blue-700 md:p-0 dark:text-gray-400 md:dark:hover:text-white dark:hover:bg-gray-700 dark:hover:text-white md:dark:hover:bg-transparent dark:border-gray-700">Courses</a>
                            </li>
                        </ul>
                    </div>
                </div>
            </nav>

            <section class="container bg-white py-8 pt-20" id="Roles">
                <div
                    class="mt-20 p-4 w-full text-center bg-white rounded-lg border shadow-md sm:p-8 dark:bg-gray-800 dark:border-gray-700">
                    <h5 class="mb-2 text-3xl font-bold text-gray-900 dark:text-white">{{jobRoleName}}</h5>
                    <p class="mb-5 text-base text-gray-500 sm:text-lg dark:text-gray-400">
                        {{jobRoleDes}}
                    </p>
                    <div class="justify-center items-center space-y-4 sm:flex sm:space-y-0 sm:space-x-4">
                        <button v-scroll-to="'#middle'" type="button"
                            class="text-white bg-gradient-to-r from-cyan-500 to-blue-500 hover:bg-gradient-to-bl focus:ring-4 focus:outline-none focus:ring-pink-200 dark:focus:ring-pink-800 font-medium rounded-lg text-sm px-5 py-2.5 text-center mr-2 mb-2">
                            Assign Skills</button>
                    </div>
                </div>

                <div id='middle'
                    class="p-8 grid grid-cols-1 sm:grid-cols-1 md:grid-cols-2 lg:grid-cols-2 xl:grid-cols-2 gap-5">
                    
                    <!-- SKILLS AVAILABLE -->
                    <div class='ml-12 lg:w-1/2 w-full xl:w-1/2'>
                        <div
                            class="p-4 lg:w-1/2 w-full bg-white rounded-lg border shadow-md sm:p-8 dark:bg-gray-800 dark:border-gray-700">
                            <div class="flex justify-between items-center mb-4">
                                <h5 class="text-xl font-bold leading-none text-gray-900 dark:text-white">Available
                                    Skills


                                </h5>
                            </div>
                            <div class="flow-root">
                                <ul role="list" class="divide-y divide-gray-200 dark:divide-gray-700">
                                    <li class="py-3 sm:py-4" v-for="skill in editedSkills">
                                        <div class="flex items-center space-x-4">
                                            <div class="flex-1 min-w-0">
                                                <p class="text-sm font-semibold text-gray-900 truncate dark:text-white">
                                                    {{skill.skill_name}}
                                                </p>
                                                <p class="text-sm text-gray-500 truncate dark:text-gray-400">
                                                    {{skill.skill_description}}
                                                </p>
                                            </div>
                                            <div
                                                class="inline-flex items-center text-base font-semibold text-gray-900 dark:text-white">
                                                <input type='checkbox' v-model='selectedSkills'
                                                    :value="skill.skill_name" v-model="selectedSkills">
                                            </div>
                                        </div>
                                    </li>
                                </ul>

                                <div
                                    class="flex flex-col justify-center items-center space-y-4 sm:flex sm:space-y-0 sm:space-x-4">
                                    <p class="text-sm font-medium text-red-700 dark:text-red-500">{{error}}</p>
                                    <button v-on:click="assignSkills()" type="button"
                                        class="mt-3 text-white bg-gradient-to-r from-cyan-500 to-blue-500 hover:bg-gradient-to-bl focus:ring-4 focus:outline-none focus:ring-pink-200 dark:focus:ring-pink-800 font-medium rounded-lg text-sm px-5 py-2.5 text-center mr-2 mb-2">
                                        Confirm Selection</button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- SKILLS ASSIGNED -->
                    <div class='ml-12 lg:w-1/2 w-full xl:w-1/2'>
                        <div
                            class="p-4 mr-12 bg-white rounded-lg border shadow-md sm:p-8 dark:bg-gray-800 dark:border-gray-700">
                            <div class="flex justify-between items-center mb-4">
                                <h5 class="text-xl font-bold leading-none text-gray-900 dark:text-white">Skills Assigned
                                </h5>
                                <!-- <a href="#" class="text-sm font-medium text-blue-600 hover:underline dark:text-blue-500">
                                View all
                            </a> -->
                            </div>
                            <div class="flow-root">
                                <ul role="list" class="divide-y divide-gray-200 dark:divide-gray-700">
                                    <li class="py-3 sm:py-4" v-for="skill in assignedSkills">
                                        <div class="flex items-center space-x-4">
                                            <div class="flex-1 min-w-0">
                                                <p class="text-sm font-semibold text-gray-900 truncate dark:text-white">
                                                    {{skill.skill_name}}
                                                </p>
                                                <p class="text-sm text-gray-500 truncate dark:text-gray-400">
                                                    {{skill.skill_description}}
                                                </p>
                                            </div>
                                        </div>
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
        </div>

        <script>
            const vm = new Vue({
                el: '#main-container',
                data: {
                    jobRoles: [],
                    jobRole: null,
                    jobRoleDes: "",
                    jobRoleName: "",
                    jobRoleID: null,
                    skills: [],
                    selectedSkills: [],
                    assignedSkills: [],
                    error: "",
                    editedSkills: []
                },
                mounted: async function () {
                    let one = "http://localhost:5010/jobroles";
                    let two = "http://localhost:5010/skills";

                    const requestOne = axios.get(one);
                    const requestTwo = axios.get(two);

                    axios.all([requestOne, requestTwo])
                        .then(axios.spread((...responses) => {
                            const responseOne = responses[0].data
                            const responseTwo = responses[1].data

                            //job roles
                            this.jobRoles = responseOne.data
                            //console.log(this.jobRoles)
                            var query = window.location.search.substring(4);
                            for (each of this.jobRoles) {
                                if (each.job_role_id == query) {
                                    this.jobRole = each
                                    //console.log(this.jobRole)
                                    this.jobRoleDes = each.job_role_description
                                    this.jobRoleName = each.job_role_name
                                    this.jobRoleID = each.job_role_id
                                }
                            }

                            //skills
                            this.skills = responseTwo.data
                            //onsole.log(this.skills)

                            //assigned skills
                            this.getAssignedSkills()

                        })).catch(errors => {
                            console.log(errors)
                        })
                },
                methods: {
                    assignSkills() {
                        console.log(this.selectedSkills)
                        // for (i in this.skills) {
                        //     if (this.selectedSkills.includes(this.skills[i].skill_name)) {
                        //         this.skills.splice(i,1)
                        //     }
                        // }
                        var skills = this.skills
                        var skillIDs = []

                        if (this.editedSkills.length == 0) {
                            this.error = "No skills available for selection!"
                        } else if (this.selectedSkills.length == 0) {
                            this.error = "Please select skills to assign"
                        } else {
                            this.error = ""
                            for (each_name of this.selectedSkills) {
                                for (each_skill of skills) {
                                    if (each_skill.skill_name == each_name) {
                                        skillIDs.push(each_skill.skill_id)
                                    }
                                }
                                console.log(skillIDs)
                                this.selectedSkills = []
                            }

                            for (each_skill_id of skillIDs) {
                                console.log(each_skill_id)
                                var url = "http://localhost:5010/skills_to_jobrole"
                                var config = {
                                    job_role_id: this.jobRoleID,
                                    //ONE SKILL ADDED ONLY
                                    skill_id: each_skill_id
                                }
                                axios.post(url, config)
                                    .then(response => {
                                        //console.log(response.data)
                                        this.getAssignedSkills()

                                    })
                                    .catch(error => {
                                        console.log(error)
                                    })
                            }
                        }
                    },
                    getAssignedSkills() {
                        var url = 'http://localhost:5010/skills_to_jobrole'
                        axios.get(url)
                            .then(response => {
                                var data = response.data.data
                                //console.log(data)
                                for (each of data) {
                                    if (each.job_role_id == this.jobRoleID) {
                                        for (each_skill of this.skills) {
                                            if (each.skill_id == each_skill.skill_id) {
                                                if (!this.assignedSkills.includes(each_skill)) {
                                                    this.assignedSkills.push(each_skill)
                                                    this.editedSkills.splice(this.editedSkills.indexOf(
                                                        each_skill), 1)
                                                }
                                            }
                                        }
                                    }
                                }
                                for (each of this.skills) {
                                    if (!this.assignedSkills.includes(each) && !this.editedSkills.includes(
                                            each)) {
                                        this.editedSkills.push(each)
                                    }
                                }
                            })
                            .catch(error => {
                                console.log(error)
                            })
                        return this.assignedSkills
                    },
                },
            })
        </script>
        <!-- flowbite -->
        <script src="https://unpkg.com/flowbite@1.5.3/dist/flowbite.js"></script>
    </body>

</html>